openapi: 3.0.3
info:
  title: Spotifete Api
  version: 0.0.1
servers:
  - url: localhost:3000
    description: dev server
tags:
  - name: authentication
    description: Authentication related routes
  - name: listeningSession
    description:  ListeningSession related routes
paths:
  /api/v2/auth/session/new:
    get:
      tags:
        - authentication
      operationId: newAuthenticationSession
      responses:
        "200":
          description: Successful created session
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/NewSessionResponse"
        "500":
          $ref: "#/components/responses/ServerError"

  /api/v2/auth/session/id/{sessionId}/is-authenticated:
    get:
      tags:
        - authentication
      operationId: isSessionAuthenticated
      responses:
        "200":
          description: Session is authenticated
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/IsSessionAuthenticatedResponse"
        "401":
          description: Session is not authenticated
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/IsSessionAuthenticatedResponse"
        "404":
          description: Unknown authentication session
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    parameters:
      - name: sessionId
        required: true
        in: path
        schema:
          type: string
  /api/v2/auth/session/id/{sessionId}/invalidate:
    patch:
      tags:
        - authentication
      operationId: invalidateAuthenticationSession
      responses:
        "204":
          description: Session was sucessfully invalidated
  /api/v2/session/new:
    post:
      tags:
        - listeningSession
      operationId: createNewListeningSession
      responses:
        "200":
          description: Created new listeningSession
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/SimpleListeningSession"
        "500":
          $ref: "#/components/schemas/ErrorResponse"
  /api/v2/session/id/{joinId}:
    get:
      tags:
        - listeningSession
      operationId: getListeningSession
      responses:
        "200":
          description: Created new listeningSession
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/ListeningSession"
        "404":
          description: Session not found
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    parameters:
      - name: joinId
        required: true
        in: path
        schema:
          type: string
components:
  responses:
    ServerError:
      description: An error occured
      content:
        "application/json":
          schema:
            $ref: "#/components/schemas/ErrorResponse"
  schemas:
    NewSessionResponse:
      type: object
      properties:
        spotify_authentication_url:
          type: string
        spotifete_session_id:
          type: string
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
    IsSessionAuthenticatedResponse:
      type: object
      properties:
        authenticated:
          type: boolean
      required:
        - authenticated
    SimpleListeningSession:
      type: object
      properties:
        active:
          type: boolean
        owner_id:
          type: integer
          format: int64
        join_id:
          type: string
        queue_playlist_id:
          type: string
        title:
          type: string
        fallback_playlist_id:
          type: string
        fallback_playlist_shuffle:
          type: boolean
    ListeningSession:
      allOf:
        - $ref: "#/components/schemas/SimpleListeningSession"
